# CDC using Debezium (README is WIP)

Example project showing how to use Debezium to carry out CDC into a Snowflake Data Warehouse, using the tutorials listed below:

* [Replicating MySQL to Snowflake with Kafka and Debezium - Part One: Data Extraction](https://blog.pythian.com/replicating-mysql-to-snowflake-with-kafka-and-debezium-part-one-data-extraction/)
* [Replicating MySQL to Snowflake with Kafka and Debezium - Part Two: Data Ingestion](https://blog.pythian.com/replicating-mysql-to-snowflake-with-kafka-and-debezium-part-two-data-ingestion/)

---

## Contents

1. Getting started
    * Prerequisites
2. References
    * Setup
    * How-to run
3. Help
4. Credits

---

## 1. High-level summary

This project provides an example of using Debezium to perform CDC into a Snowflake Data Warehouse.

Where the example uses the following technologies:

##### Technologies used

* **MySQL** to act as an example source DB
* **Snowflake** as the target data warehouse
* **Kafka** as a stream processing engine (and *Zookeeper* to manage the Kafka cluster)
* **Kafka connectors** to connect the source and target databases. Specifically:
    * **Debezium** to connect to the source MySQL DB to Kafka
    * And a **Snowflake Kafka connector**

---

## 1. Getting started

### Prerequisites

The very first thing is to install the required software. This means installing:

So before you begin, ensure you have met the following requirements:

* (Ideally) you're using a Mac or Linux
* [Homebrew package manager](https://brew.sh/)
* [JDK 1.8 or higher](https://www.oracle.com/au/java/technologies/javase/javase-jdk8-downloads.html) (can install using brew, `brew install java`)
* [Wget](https://www.gnu.org/software/wget/) (can install using brew, `brew install wget`)
* A Snowflake account with `ACCOUNTADMIN` privileges
* [SnowSQL](https://docs.snowflake.com/en/user-guide/snowsql.html)

### Installation

To install the required project software, run `make installations`. Where this will:

* Ensure you've installed the prerequisites technologies outlined above (outlined in the `deps` target within the `Makefile`)
* Download the software outlined within the high-level summary above. I.e.:
    * [ZooKeeper]()
    * [Kafka]()
    * [Debezium connector for MySQL]()
    * [Snowflake Kafka connector]()
    * As well as a [prerequisite library (`Bouncy Castle`) for the Snowflake Kafka cluster](https://docs.snowflake.com/en/user-guide/kafka-connector-install.html#download-the-kafka-connector-files)
* Following these downloads, the `make installations` command will then install the above software

### Setup

With the required software downloaded and installed, some project setup / configuration is required.

To do so, run `make setup`. Where this will:

* Prepare a sample MySQL db
    * To create a sample database and table, containing some sample data. These scripts are contained within `src/sql/mysql/`
* Prepare Snowflake
    * To create the prerequisite Snowflake 'scaffolding' objects. E.g. Warehouse, database, super user role and example user
* Configure additional Kafka settings,  e.g. to specify the plugins folder directory
* Generate an RSA key pair, to ensure data is sent from the MySQL db to Snowflake securely
* Update the credentials of the Snowflake role, to use this RSA key

### How-to run

With the prerequisites, install and setup complete, you're now able to run the program by entering `make run`. Where this starts:

* The Zookeeper service
* The Kafka cluster
* The Debezium MySQL connector
* and finally, the Snowflake Kafka cluster

## 3. Help

To help with troubleshooting, see the log files generated by both the Debezium and Snowflake Kafka connectors.

Both of these can be found within the `log` directory, where logs named:

* `debezium_connector_...` describe Debezium logs
* and `snowflake_connector_...` describe the Snowflake Kafka connector logs

---

## 4. Credits

This project has come about from following the notes described in the two blog posts below (parts 1 and 2):

* [replicating-mysql-to-snowflake-with-kafka-and-debezium-part-one-data-extraction](https://blog.pythian.com/replicating-mysql-to-snowflake-with-kafka-and-debezium-part-one-data-extraction/)

* [replicating-mysql-to-snowflake-with-kafka-and-debezium-part-two-data-ingestion/](https://blog.pythian.com/replicating-mysql-to-snowflake-with-kafka-and-debezium-part-two-data-ingestion/)

In addition, Snowflake's instructions for [installing and configuring a Kafka connector](https://docs.snowflake.com/en/user-guide/kafka-connector-install.html#download-the-kafka-connector-files) were followed, to help provide some context to the blog post. Particularly with regard to the information around the prerequisite library (`Bouncy Castle`) for the Snowflake Kafka cluster.
